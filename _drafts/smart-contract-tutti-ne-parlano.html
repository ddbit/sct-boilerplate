---
layout: post
title: Smart Contract, tutti ne parlano
date:
type: post
parent_id: '0'
published: false
password: ''
status: pending
categories:
- Smart Contracts
tags: []
meta:
  jabber_published: '1483194933'
  _rest_api_published: '1'
  _rest_api_client_id: "-1"
  _publicize_job_id: '263753994'
  email_notification: '1483194934'
  _elasticsearch_indexed_on: '2016-12-31 14:35:34'
  _last_editor_used_jetpack: block-editor
  _edit_last: '48926058'
  _aioseo_title: ''
  _aioseo_description: ''
  _aioseo_keywords: ''
  _aioseo_og_title: ''
  _aioseo_og_description: ''
  _aioseo_og_article_section: ''
  _aioseo_og_article_tags: ''
  _aioseo_twitter_title: ''
  _aioseo_twitter_description: ''
  _thumbnail_id: '2391'
  ppma_authors_name: Davide
author:
  login: divisionista
  email: dcarboni@gmail.com
  display_name: Davide
  first_name: Davide
  last_name: ''
permalink: "/"
---
<p>[caption id="attachment_2391" align="alignnone" width="320"]<img class="alignnone  wp-image-2391" src="{{ site.baseurl }}/assets/bill_of_sale_louvre_ao3765.jpg" alt="bill_of_sale_louvre_ao3765" width="320" height="310" /> contratto sumero - attesta la proprietà di uno schiavo[/caption]</p>
<p>Ma cosa sono? Quando si parla di smart contract, ed in particolare di quelli basati sulla blockchain Ethereum ci si imbatte presto in questa affermazione:</p>
<blockquote><p>Uno smart contract non è né smart né contract.</p></blockquote>
<p>Ricordiamo che Ethereum è una rete peer to peer che utilizza un protocollo ispirato a quello del Bitcoin per assicurare l'integrità di un registro globale di transazioni. In aggiunta a quanto già svolto benissimo da Bitcoin, Ethereum mette a disposizione uno strumento ed un linguaggio formale per la scrittura di smart contract. La domanda immediata è: perché non esistono gli smart contract su Bitcoin? In realtà esistono, ma diciamo che ci sono delle limitazioni, non tecniche ma volute in fase di progetto, che impediscono di codificare una logica complessa dentro una transazione Bitcoin. La value proposition di Ethereum è proprio questa, <strong>fare quello che Bitcoin ha deciso di non fare per timore di inficiare la sicurezza. Ethereum vuole correre il rischio.</strong></p>
<p>Tornando al paradosso che gli smart contract non sono né smart né contract vediamo come spiegarlo. Con smart ci riferiamo a qualcosa di intelligente, ok gli smartphone non sono in effetti così intelligenti, ma lo diciamo per distinguerli dai dumb phone, quelli che servivano solo a fare le telefonate. Così, un po' per estensione, tutto quello che è innovativo lo vorremmo chiamare smart, ma di fatto sarebbe <strong>più corretto dire contratto crittografico o contratto digitale</strong>.</p>
<p>Occhio che digitale non significa digitalizzato, non è che prendiamo un contratto cartaceo e lo digitalizziamo questo diventa uno smart contract. Digitale significa che può fare uso delle tecniche digitali (leggi numeriche) per consentire alcune proprietà: ad esempio l'autenticità. Questo si ottiene attraverso la crittografia.</p>
<p>Smart in realtà dovrebbe significare "<strong>capace di ragionare con dati incompleti</strong>" mimando in qualche modo il ragionamento o l'intuizione umana. Qualcosa più legato all'intelligenza artificiale che alla certezza crittografica. Ma questo è esattamente quello che non vogliamo nei contratti digitali: la discrezionalità dell'interpretazione che porta facilmente alla corruzione e all'ingiustizia.</p>
<p>Vediamo perché non è un contract. Cos'è un contratto? Secondo il codice civile italiano</p>
<blockquote><p>Il contratto è l'accordo di due o più parti per costituire, regolare o estinguere tra loro un rapporto giuridico patrimoniale.</p></blockquote>
<p>Insomma, serve definire le parti, che nell'ordinamento italiano saranno persone fisiche o giuridiche mentre nel caso degli smart contract basati su Ethereum queste parti non ci sono, o meglio non sono definite. Ci sono solo account e le loro chiavi private. Potrebbero essere possedute da un minore, da un robot, da uno scimpanzè, etc. da qui la difficoltà di stabilire le parti nel modo in cui si fa per i contratti tradizionali. Il contratto stesso su Ethereum può possedere una dotazione finanziaria (nella sua criptomoneta chiamata ether). Insomma un contratto su Ethereum è più che altro un agente artificiale (non intelligente però) dotato di fondi propri che può interagire con altri attori anch'essi dotati di chiavi crittografiche ed account sulla blockchain. Inoltre sempre secondo il codice civile</p>
<blockquote><p>L'oggetto del contratto deve essere possibile, lecito, determinato o determinabile</p></blockquote>
<p>Ammesso di poter identificare un oggetto nel caso degli smart contract, i concetti di possibile, lecito, determinato devono essere traslati nel vocabolario della blockchain e quindi: non esiste il concetto di possibile/impossibile ma quello di valido o non valido. La blockchain è fatta di transazioni, esse sono <strong>possibili</strong> se la matematica lo  consente ( esempio se hai 1 ether non puoi spenderne 1.5). Le transazioni sono verificate e successivamente inserite nel registro globale.</p>
<p>Lecito significa a norma di legge, ma in questo caso la legge è  il protocollo informatico e non la legge stabilità dalla giurisdizione in cui opera il nodo della rete.</p>
<p><strong>Code is law</strong></p>
<p>Ci piaccia o no, sembra essere così. La natura degli smart contract è quindi più quella di processi o agenti che di contratti intesi come accordi. Tali processi obbediscono ad un codice sorgente che ne stabilisce la logica e le condizioni. <strong>Quindi in realtà i contratti sono dei veri e propri programmi in esecuzione</strong>. Come tutti i programmi in esecuzioni hanno delle variabili, ad esempio numeri o stringhe, che sono definite e manipolate dal codice stesso.</p>
<p>Quindi, se non sono contratti a cosa servono e cosa si può fare? Ci sono diverse applicazioni:</p>
<ul>
<li><strong>Aziende decentralizzate</strong>, attraverso un fondo comune soggetto a regole con cui i partecipanti possono votare per le spese da sostenere e regole per i dividendi</li>
<li><strong>Testamento</strong>, stabilisce che una somma venga spedita al verificarsi della morte di una persona.</li>
<li><strong>Regalo</strong> di compleanno, in cui una somma viene spedita solo al compimento dei 18 anni.</li>
<li>un contratto di <strong>assicurazione</strong> che risarcisce automaticamente al verificarsi di un sinistro.</li>
<li>diventare <a href="https://www.kingoftheether.com/" target="_blank" rel="noopener">king of ether</a></li>
</ul>
<p>e molti altri ....</p>
<p>Quindi <strong>qual è la peculiarità degli smart contract rispetto ai normali programmi del calcolatore?</strong> Beh, possiamo dire che la loro forza sta nel fatto <strong>che nessuno può spegnerli, una volta avviati</strong>, se la terminazione non è prevista nel loro codice, allora saranno per sempre in esecuzione. Si potrebbe suggerire che per spegnere un programma basta staccare la spina al computer che lo esegue, ma qui sta il bello ed il brutto della blockchain: il programma viene eseguito contemporaneamente ed in modo identico da tutti i nodi della blockchain che sono migliaia. Il bello: nessuno può staccare la spina. Il brutto? L'esecuzione più energeticamente inefficiente che possiamo immaginare. Ma ricordiamo come nel caso del Bitcoin. La blockchain è progettata per la sicurezza in un ambiente estremamente ostile dove <strong>tutti i partecipanti sono hacker esperti, malintenzionati e anonimi che provano ad imbrogliare mentre indossano la maschera di Guy Fawkes,</strong> e nonostante questo la sicurezza e l'onestà delle transazioni è garantita. La blockchain non è pensata per essere energeticamente efficiente.</p>
<p>Se un avversario ostile staccasse la spina al 50% dei nodi (nodi = computer) in poche ore il protocollo si auto-adatterebbe rendendo appetibile a molti nuovi potenziali nodi il loro ingresso. Di fatto i nodi sono sempre in competizione fra loro e se la competizione è più facile questo fa si che immediatamente altri nodi si aggiungano.</p>
<p>Vista la natura descritta fin qui appare chiaro che gli smart contract sono dei processi che automatizzano il trasferimento di valuta in modo automatico e decentralizzato e non sono stati pensati dagli avvocati ma piuttosto dagli ingegneri. Sarebbe interessante capire come e se ai giuristi potrà interessare influenzare questa tecnologia.</p>
<p>Segue esempio di contract, come vedete è <strong>assolutamente</strong> per programmatori.</p>
<pre><span class="nx">pragma</span> <span class="nx">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="kd">contract</span> <span class="nx">Purchase</span> <span class="p">{</span>
    <span class="kt">uint</span> <span class="k">public</span> <span class="nx">value</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">seller</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">public</span> <span class="nx">buyer</span><span class="p">;</span>
    <span class="kd">enum</span> <span class="nx">State</span> <span class="p">{</span> <span class="nx">Created</span><span class="p">,</span> <span class="nx">Locked</span><span class="p">,</span> <span class="nx">Inactive</span> <span class="p">}</span>
    <span class="nx">State</span> <span class="k">public</span> <span class="nx">state</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">Purchase</span><span class="p">()</span> <span class="nx">payable</span> <span class="p">{</span>
        <span class="nx">seller</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span> <span class="o">!=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">require</span><span class="p">(</span><span class="kt">bool</span> <span class="nx">_condition</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">_condition</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">onlyBuyer</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">buyer</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">onlySeller</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span> <span class="o">!=</span> <span class="nx">seller</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">modifier</span> <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span> <span class="nx">_state</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">state</span> <span class="o">!=</span> <span class="nx">_state</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="nx">_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">event</span> <span class="nx">aborted</span><span class="p">();</span>
    <span class="kd">event</span> <span class="nx">purchaseConfirmed</span><span class="p">();</span>
    <span class="kd">event</span> <span class="nx">itemReceived</span><span class="p">();</span>

    <span class="cs">/// Abort the purchase and reclaim the ether.</span>
    <span class="cs">/// Can only be called by the seller before</span>
    <span class="cs">/// the contract is locked.</span>
    <span class="kd">function</span> <span class="nx">abort</span><span class="p">()</span>
        <span class="nx">onlySeller</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Created</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">aborted</span><span class="p">();</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">seller</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">))</span>
            <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Confirm the purchase as buyer.</span>
    <span class="cs">/// Transaction has to include `2 * value` ether.</span>
    <span class="cs">/// The ether will be locked until confirmReceived</span>
    <span class="cs">/// is called.</span>
    <span class="kd">function</span> <span class="nx">confirmPurchase</span><span class="p">()</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Created</span><span class="p">)</span>
        <span class="nx">require</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">*</span> <span class="nx">value</span><span class="p">)</span>
        <span class="nx">payable</span>
    <span class="p">{</span>
        <span class="nx">purchaseConfirmed</span><span class="p">();</span>
        <span class="nx">buyer</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">sender</span><span class="p">;</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Locked</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cs">/// Confirm that you (the buyer) received the item.</span>
    <span class="cs">/// This will release the locked ether.</span>
    <span class="kd">function</span> <span class="nx">confirmReceived</span><span class="p">()</span>
        <span class="nx">onlyBuyer</span>
        <span class="nx">inState</span><span class="p">(</span><span class="nx">State</span><span class="p">.</span><span class="nx">Locked</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nx">itemReceived</span><span class="p">();</span>
        <span class="c1">// It is important to change the state first because</span>
        <span class="c1">// otherwise, the contracts called using `send` below</span>
        <span class="c1">// can call in again here.</span>
        <span class="nx">state</span> <span class="o">=</span> <span class="nx">State</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">;</span>
        <span class="c1">// This actually allows both the buyer and the seller to</span>
        <span class="c1">// block the refund.</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">buyer</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="nx">seller</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">balance</span><span class="p">))</span>
            <span class="k">throw</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre>
